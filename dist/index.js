import{fileURLToPath as W}from"url";import z from"path";var G=()=>W(import.meta.url),J=()=>z.dirname(G()),d=J();import{cac as xt}from"cac";import F from"prompts";import b from"picocolors";var a=t=>{console.log(b.blue(t))},s=t=>{console.log(b.red(t))},h=t=>{console.log(b.green(t))},c=()=>{console.log()},w=t=>{console.log(t)};import _ from"path";import{existsSync as wt}from"fs";import{lstatSync as K,readdirSync as V,promises as q,constants as Y}from"fs";import H from"path";var Q=["node_modules","favicon.ico"],P=t=>!t||typeof t!="string"?(s("An App name must be provided and it should be a string"),!1):t.length?t.match(/^\./)?(s("App name cannot start with a period"),!1):t.match(/^_/)?(s("App name cannot start with an underscore"),!1):t.trim()!==t?(s("name cannot contain leading or trailing spaces"),!1):(Q.forEach(function(e){if(t.toLowerCase()===e)return s(e+" is a blacklisted name"),!1}),/[~'!()*%&]/.test(t.split("/").slice(-1)[0])?(s(`name can no longer contain special characters ("~'!()*%&")`),!1):!0):(s("App name must be greate than zero"),!1),j=(t,e)=>{let r=V(t);if(r.length>0){a(`The directory ${e} contains file that could conflict:`),c();for(let n of r)try{K(H.join(t,n)).isDirectory()?a(`  ${n}`):w(`  ${n}`)}catch{w(`  ${n}`)}return c(),a("Either try using a new directory name, or remove the files listed above."),c(),!1}return!0};async function I(t){try{return await q.access(t,Y.W_OK),!0}catch{return!1}}import{statSync as X,promises as E}from"fs";import p from"path";import Z from"fast-glob";import{fileURLToPath as tt}from"url";import et from"cross-spawn";var S={"bun.lockb":"bun","pnpm-lock.yaml":"pnpm","yarn.lock":"yarn","package-lock.json":"npm","npm-shrinkwrap.json":"npm"},rt=t=>t instanceof URL?tt(t):t,ot={directory:"isDirectory",file:"isFile"},nt=(t,e)=>e[ot[t]](),it=(t,{cwd:e,type:r="file"})=>{e=rt(e);for(let n of t)try{let o=X(p.resolve(e,n),{throwIfNoEntry:!1});if(!o)continue;if(nt(r,o))return n}catch{}};function st(t){let e=p.resolve(process.cwd())??"",{root:r}=p.parse(e),n=[t].flat(),o=p.resolve(r),i=l=>it(n,l),f=[];for(;;){let l=i({cwd:e});if(l&&f.push(p.resolve(e,l)),e===o)break;e=p.dirname(e)}return f[0]}function $(){let t=st(Object.keys(S)),e;return e=S[p.basename(t)],e}var at=t=>t,A=async(t,e,{cwd:r,rename:n=at}={})=>{let o=typeof t=="string"?[t]:t;if(o.length===0||!e)throw new TypeError("`src` and `dest` are required");let i=await Z.async(o,{cwd:r,dot:!0,absolute:!1,stats:!1}),f=r?p.resolve(r,e):e;return Promise.all(i.map(async l=>{let u=p.dirname(l),m=n(p.basename(l)),N=r?p.resolve(r,l):l,x=p.join(f,u,m);return await E.mkdir(p.dirname(x),{recursive:!0}),E.copyFile(N,x)}))},D=async t=>{let e=[t==="yarn"?"":"install"];return new Promise((r,n)=>{let o=et(t,e,{stdio:"inherit",env:{...process.env,ADBLOCK:"1",NODE_ENV:"development",DISABLE_OPENCOLLECTIVE:"1"}});o.stdout?.on("data",i=>{console.log(i)}),o.on("close",i=>{if(i!==0){n({command:`${t} ${e.join(" ")}`});return}r()})})};import L,{dirname as yt}from"path";import{mkdirSync as ht}from"fs";import T from"path";import{writeFile as ct}from"fs/promises";import pt from"node:os";import M from"picocolors";import lt from"ora";var C=async({appName:t,root:e,template:r,packageManager:n})=>{a(`Using ${n}`),c(),a(`Initializing project with template: ${r}
`);let o=lt("Pulling template").start(),i=T.join(d,r),f=["**"];r==="normal"&&f.push("!tailwind.config.js","!postcss.config.js");try{await A(f,e,{cwd:i,rename(m){switch(m){case"gitignore":case"eslintrc.cjs":return`.${m}`;case"README-template.md":return"README.md";default:return m}}}),o.succeed("Succeed to pull template to local")}catch{o.fail("Fail to pull template to local, please try again!")}let u={name:t,version:"1.0.0",private:!0,type:"module",scripts:{dev:"vite",build:"tsc && vite build",lint:"eslint --fix . --ext ts,tsx --report-unused-disable-directives --max-warnings 0",preview:"vite preview",prepare:"husky"},dependencies:{axios:"^1.6.8",react:"^18.2.0","react-dom":"^18.2.0","react-router":"^6.22.3","react-router-dom":"^6.22.3"},devDependencies:{"@types/node":"^20.12.11","@types/react":"^18.2.66","@types/react-dom":"^18.2.22","@typescript-eslint/eslint-plugin":"^7.2.0","@typescript-eslint/parser":"^7.2.0","@vitejs/plugin-react":"^4.2.1",eslint:"^8.57.0","eslint-config-prettier":"^9.1.0","eslint-plugin-prettier":"^5.1.3","eslint-plugin-react-hooks":"^4.6.0","eslint-plugin-react-refresh":"^0.4.6",husky:"^9.0.11",prettier:"3.2.5",typescript:"^5.2.2",vite:"^5.2.0"}};r==="tailwind"&&(u.devDependencies={...u.devDependencies,autoprefixer:"^10.4.19",postcss:"^8.4.38","prettier-plugin-tailwindcss":"^0.5.14",tailwindcss:"^3.4.3"}),await ct(T.join(e,"package.json"),JSON.stringify(u,null,2)+pt.EOL),a(`
Installing dependencies:`);for(let m in u.dependencies)console.log(`- ${M.cyan(m)}`);a(`
Installing devDependencies:`);for(let m in u.devDependencies)console.log(`- ${M.cyan(m)}`);c(),await D(n)};import{execSync as g}from"child_process";import{rmSync as mt}from"fs";import dt from"path";var ft=()=>{try{return g("git rev-parse --is-inside-work-tree",{stdio:"ignore"}),!0}catch{return!1}},gt=()=>{try{return g("hg --cwd . root",{stdio:"ignore"}),!0}catch{return!1}},ut=()=>{try{return g("git config init.defaultBranch",{stdio:"ignore"}),!0}catch{return!1}},O=t=>{let e=!1;try{return g("git --version",{stdio:"ignore"}),ft()||gt()?!1:(g("git init",{stdio:"ignore"}),ut()||g("git checkout -b main",{stdio:"ignore"}),g("git add -A",{stdio:"ignore"}),g('git commit -m "Initial commit from chaos"',{stdio:"ignore"}),!0)}catch{if(e)try{mt(dt.join(t,".git"),{recursive:!0,force:!0})}catch{}return!1}};var R=async({projectPath:t,tailwind:e,packageManager:r})=>{let n=e?"tailwind":"normal",o=L.resolve(t);await I(yt(o))||(s("The application path is not writable, please check folder permissions and try again."),s("It is likely you do not have write permissions for this folder."),process.exit(1));let i=L.basename(o);ht(o,{recursive:!0});let f=process.cwd();h(`Creating a new vite app in ${o}.`),c(),process.chdir(o),await C({appName:i,root:o,template:n,packageManager:r}),O(o)&&(a("Initialized a git repository."),c()),h(`Project ${i} set up successfully`),c(),w("Inside that directory, you can run several commands:"),a(`  ${r} dev to start the development server.`),c(),a(`  ${r} build to build the App for production.`),c(),process.chdir(`${process.cwd()}`)};var U=t=>{s(`Command cancelled when setting ${t.name}`),process.exit(1)},vt=(t,e,r)=>{},bt=t=>{let e=_.resolve(t.trim()),r=_.basename(e);return wt(e)&&!j(e,r)&&process.exit(1),e};async function k(t,{tailwind:e}){let r={projectName:t,useTailwind:e};if(!t){let{project:i}=await F({type:"text",name:"project",message:"Your project name:",initial:"ViteReactTemplate"},{onCancel:U});r.projectName=i}if(P(r.projectName)||(console.log(1),process.exit(1)),!e){let{tailwind:i}=await F({type:"toggle",name:"tailwind",message:"Would you like to use tailwindcss?",initial:!0,active:"yes",inactive:"no"},{onCancel:U,onSubmit:vt});r.useTailwind=i}h("resolve config successfully!");let n=bt(r.projectName),o=$();try{await R({projectPath:n,packageManager:o,tailwind:r.useTailwind})}catch(i){console.log(i),s("crashed when downloading packages, please try again")}}var B={name:"chaos-template-cli",version:"1.1.2",description:"",main:"src/cli.ts",scripts:{start:"tsup src/cli.ts --watch",build:"tsup-node --minify",test:"echo 'no test specified'",prepare:"husky"},bin:{chaos:"dist/index.js"},keywords:[],author:"chaosspace",type:"module",license:"ISC",dependencies:{cac:"^6.7.14","cross-spawn":"^7.0.3","fast-glob":"^3.3.2","locate-path":"^7.2.0",ora:"^8.0.1",picocolors:"^1.0.0",prompts:"^2.4.2",tsup:"^8.0.2"},devDependencies:{"@types/cross-spawn":"^6.0.6","@types/node":"^20.12.10","@types/prompts":"^2.4.9",husky:"^9.0.11",typescript:"^5.4.5"}};var v=xt();v.version(B.version);v.command("[projectName]","create project from template").option("-t, --tailwind","use tailwindcss").action(async(t,e)=>{await k(t,e)});v.help();v.parse();
