import{fileURLToPath as W}from"url";import z from"path";var G=()=>W(import.meta.url),J=()=>z.dirname(G()),d=J();import{cac as kt}from"cac/dist/index.js";import R from"prompts";import v from"picocolors";var c=t=>{console.log(v.blue(t))},a=t=>{console.log(v.red(t))},y=t=>{console.log(v.green(t))},p=()=>{console.log()},h=t=>{console.log(t)};import _ from"path";import{existsSync as ht}from"fs";import{lstatSync as K,readdirSync as V,promises as q,constants as Y}from"fs";import H from"path";var Q=["node_modules","favicon.ico"],x=t=>{if(!t||typeof t!="string")return a("An App name must be provided and it should be a string"),!1;if(!t.length)return a("App name must be greate than zero"),!1;t.match(/^\./)&&a("App name cannot start with a period"),t.match(/^_/)&&a("App name cannot start with an underscore"),t.trim()!==t&&a("name cannot contain leading or trailing spaces"),Q.forEach(function(e){t.toLowerCase()===e&&a(e+" is a blacklisted name")}),/[~'!()*%&]/.test(t.split("/").slice(-1)[0])&&a(`name can no longer contain special characters ("~'!()*%&")`)},P=(t,e)=>{let r=V(t);if(r.length>0){c(`The directory ${e} contains file that could conflict:`),p();for(let n of r)try{K(H.join(t,n)).isDirectory()?c(`  ${n}`):h(`  ${n}`)}catch{h(`  ${n}`)}return p(),c("Either try using a new directory name, or remove the files listed above."),p(),!1}return!0};async function j(t){try{return await q.access(t,Y.W_OK),!0}catch{return!1}}import{statSync as X,promises as I}from"fs";import l from"path";import Z from"fast-glob";import{fileURLToPath as tt}from"url";import et from"cross-spawn";var E={"bun.lockb":"bun","pnpm-lock.yaml":"pnpm","yarn.lock":"yarn","package-lock.json":"npm","npm-shrinkwrap.json":"npm"},rt=t=>t instanceof URL?tt(t):t,nt={directory:"isDirectory",file:"isFile"},ot=(t,e)=>e[nt[t]](),it=(t,{cwd:e,type:r="file"})=>{e=rt(e);for(let n of t)try{let o=X(l.resolve(e,n),{throwIfNoEntry:!1});if(!o)continue;if(ot(r,o))return n}catch{}};function st(t){let e=l.resolve(process.cwd())??"",{root:r}=l.parse(e),n=[t].flat(),o=l.resolve(r),i=s=>it(n,s),u=[];for(;;){let s=i({cwd:e});if(s&&u.push(l.resolve(e,s)),e===o)break;e=l.dirname(e)}return u[0]}function $(){let t=st(Object.keys(E)),e;return e=E[l.basename(t)],e}var at=t=>t,A=async(t,e,{cwd:r,rename:n=at}={})=>{let o=typeof t=="string"?[t]:t;if(o.length===0||!e)throw new TypeError("`src` and `dest` are required");let i=await Z.async(o,{cwd:r,dot:!0,absolute:!1,stats:!1}),u=r?l.resolve(r,e):e;return Promise.all(i.map(async s=>{let m=l.dirname(s),B=n(l.basename(s)),N=r?l.resolve(r,s):s,k=l.join(u,m,B);return await I.mkdir(l.dirname(k),{recursive:!0}),I.copyFile(N,k)}))},D=async t=>{let e=[t==="yarn"?"":"install"];return new Promise((r,n)=>{et(t,e,{stdio:"inherit",env:{...process.env,ADBLOCK:"1",NODE_ENV:"development",DISABLE_OPENCOLLECTIVE:"1"}}).on("close",i=>{if(i!==0){n({command:`${t} ${e.join(" ")}`});return}r()})})};import O,{dirname as ut}from"path";import{mkdirSync as yt}from"fs";import S from"path";import{writeFile as ct}from"fs/promises";import pt from"node:os";import T from"picocolors";var M=async({appName:t,root:e,template:r,packageManager:n})=>{c(`Using ${n}`),p(),c(`Initializing project with template: ${r}
`);let o=S.join(d,r),i=["**"];r==="normal"&&i.push("!tailwind.config.js","!postcss.config.js"),await A(i,e,{cwd:o,rename(m){switch(m){case"gitignore":case"eslintrc.cjs":return`.${m}`;case"README-template.md":return"README.md";default:return m}}});let s={name:t,version:"1.0.0",private:!0,type:"module",scripts:{dev:"vite",build:"tsc && vite build",lint:"eslint --fix . --ext ts,tsx --report-unused-disable-directives --max-warnings 0",preview:"vite preview",prepare:"husky"},dependencies:{axios:"^1.6.8",react:"^18.2.0","react-dom":"^18.2.0","react-router":"^6.22.3","react-router-dom":"^6.22.3"},devDependencies:{"@types/node":"^20.12.11","@types/react":"^18.2.66","@types/react-dom":"^18.2.22","@typescript-eslint/eslint-plugin":"^7.2.0","@typescript-eslint/parser":"^7.2.0","@vitejs/plugin-react":"^4.2.1",eslint:"^8.57.0","eslint-config-prettier":"^9.1.0","eslint-plugin-prettier":"^5.1.3","eslint-plugin-react-hooks":"^4.6.0","eslint-plugin-react-refresh":"^0.4.6",husky:"^9.0.11",prettier:"3.2.5",typescript:"^5.2.2",vite:"^5.2.0"}};r==="tailwind"&&(s.devDependencies={...s.devDependencies,autoprefixer:"^10.4.19",postcss:"^8.4.38","prettier-plugin-tailwindcss":"^0.5.14",tailwindcss:"^3.4.3"}),await ct(S.join(e,"package.json"),JSON.stringify(s,null,2)+pt.EOL),c(`
Installing dependencies:`);for(let m in s.dependencies)console.log(`- ${T.cyan(m)}`);c(`
Installing devDependencies:`);for(let m in s.devDependencies)console.log(`- ${T.cyan(m)}`);p(),await D(n)};import{execSync as f}from"child_process";import{rmSync as lt}from"fs";import mt from"path";var dt=()=>{try{return f("git rev-parse --is-inside-work-tree",{stdio:"ignore"}),!0}catch{return!1}},ft=()=>{try{return f("hg --cwd . root",{stdio:"ignore"}),!0}catch{return!1}},gt=()=>{try{return f("git config init.defaultBranch",{stdio:"ignore"}),!0}catch{return!1}},C=t=>{let e=!1;try{return f("git --version",{stdio:"ignore"}),dt()||ft()?!1:(f("git init",{stdio:"ignore"}),gt()||f("git checkout -b main",{stdio:"ignore"}),f("git add -A",{stdio:"ignore"}),f('git commit -m "Initial commit from chaos"',{stdio:"ignore"}),!0)}catch{if(e)try{lt(mt.join(t,".git"),{recursive:!0,force:!0})}catch{}return!1}};var L=async({projectPath:t,tailwind:e,packageManager:r})=>{let n=e?"tailwind":"normal",o=O.resolve(t);await j(ut(o))||(a("The application path is not writable, please check folder permissions and try again."),a("It is likely you do not have write permissions for this folder."),process.exit(1));let i=O.basename(o);yt(o,{recursive:!0});let u=process.cwd();y(`Creating a new vite app in ${o}.`),p(),process.chdir(o),await M({appName:i,root:o,template:n,packageManager:r}),C(o)&&(c("Initialized a git repository."),p()),y(`Project ${i} set up successfully`),p(),h("Inside that directory, you can run several commands:"),c(`  ${r} dev to start the development server.`),p(),c(`  ${r} build to build the App for production.`),p(),process.chdir(`${process.cwd()}/${i}`)};var F=t=>{a(`Command cancelled when setting ${t.name}`),process.exit(1)},wt=(t,e,r)=>{},vt=t=>{let e=_.resolve(t.trim()),r=_.basename(e);return ht(e)&&!P(e,r)&&process.exit(1),e};async function b(t,{tailwind:e}){let r={projectName:t,useTailwind:e};if(!t){let{project:i}=await R({type:"text",name:"project",message:"Your project name:",initial:"ViteReactTemplate"},{onCancel:F});r.projectName=i}if(x(r.projectName)||process.exit(1),!e){let{tailwind:i}=await R({type:"toggle",name:"tailwind",message:"Would you like to use tailwindcss?",initial:!0,active:"yes",inactive:"no"},{onCancel:F,onSubmit:wt});r.useTailwind=i}y("resolve config successfully!");let n=vt(r.projectName),o=$();try{await L({projectPath:n,packageManager:o,tailwind:r.useTailwind})}catch(i){console.log(i),a("crashed when downloading packages, please try again")}}var U={name:"chaos-template-cli",version:"1.1.2",description:"",main:"src/cli.ts",scripts:{start:"tsup src/cli.ts --watch",build:"tsup-node --minify",test:"echo 'no test specified'",prepare:"husky"},bin:{chaos:"dist/index.js"},keywords:[],author:"chaosspace",type:"module",license:"ISC",dependencies:{cac:"^6.7.14","cross-spawn":"^7.0.3","fast-glob":"^3.3.2","locate-path":"^7.2.0",ora:"^8.0.1",picocolors:"^1.0.0",prompts:"^2.4.2",tsup:"^8.0.2"},devDependencies:{"@types/cross-spawn":"^6.0.6","@types/node":"^20.12.10","@types/prompts":"^2.4.9",husky:"^9.0.11",typescript:"^5.4.5"}};var w=kt();w.version(U.version);w.command("[projectName]","create project from template").option("-t, --tailwind","use tailwindcss").action(async(t,e)=>{await b(t,e)});w.help();w.parse();
