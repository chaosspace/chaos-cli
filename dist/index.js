import{fileURLToPath as W}from"url";import z from"path";var G=()=>W(import.meta.url),J=()=>z.dirname(G()),d=J();import{cac as ke}from"cac";import R from"prompts";import v from"picocolors";var c=e=>{console.log(v.blue(e))},a=e=>{console.log(v.red(e))},y=e=>{console.log(v.green(e))},p=()=>{console.log()},h=e=>{console.log(e)};import _ from"path";import{existsSync as he}from"fs";import{lstatSync as K,readdirSync as V,promises as q,constants as Y}from"fs";import H from"path";var Q=["node_modules","favicon.ico"],x=e=>!e||typeof e!="string"?(a("An App name must be provided and it should be a string"),!1):e.length?e.match(/^\./)?(a("App name cannot start with a period"),!1):e.match(/^_/)?(a("App name cannot start with an underscore"),!1):e.trim()!==e?(a("name cannot contain leading or trailing spaces"),!1):(Q.forEach(function(t){if(e.toLowerCase()===t)return a(t+" is a blacklisted name"),!1}),/[~'!()*%&]/.test(e.split("/").slice(-1)[0])?(a(`name can no longer contain special characters ("~'!()*%&")`),!1):!0):(a("App name must be greate than zero"),!1),P=(e,t)=>{let r=V(e);if(r.length>0){c(`The directory ${t} contains file that could conflict:`),p();for(let o of r)try{K(H.join(e,o)).isDirectory()?c(`  ${o}`):h(`  ${o}`)}catch{h(`  ${o}`)}return p(),c("Either try using a new directory name, or remove the files listed above."),p(),!1}return!0};async function j(e){try{return await q.access(e,Y.W_OK),!0}catch{return!1}}import{statSync as X,promises as I}from"fs";import l from"path";import Z from"fast-glob";import{fileURLToPath as ee}from"url";import te from"cross-spawn";var E={"bun.lockb":"bun","pnpm-lock.yaml":"pnpm","yarn.lock":"yarn","package-lock.json":"npm","npm-shrinkwrap.json":"npm"},re=e=>e instanceof URL?ee(e):e,ne={directory:"isDirectory",file:"isFile"},oe=(e,t)=>t[ne[e]](),ie=(e,{cwd:t,type:r="file"})=>{t=re(t);for(let o of e)try{let n=X(l.resolve(t,o),{throwIfNoEntry:!1});if(!n)continue;if(oe(r,n))return o}catch{}};function se(e){let t=l.resolve(process.cwd())??"",{root:r}=l.parse(t),o=[e].flat(),n=l.resolve(r),i=s=>ie(o,s),u=[];for(;;){let s=i({cwd:t});if(s&&u.push(l.resolve(t,s)),t===n)break;t=l.dirname(t)}return u[0]}function $(){let e=se(Object.keys(E)),t;return t=E[l.basename(e)],t}var ae=e=>e,A=async(e,t,{cwd:r,rename:o=ae}={})=>{let n=typeof e=="string"?[e]:e;if(n.length===0||!t)throw new TypeError("`src` and `dest` are required");let i=await Z.async(n,{cwd:r,dot:!0,absolute:!1,stats:!1}),u=r?l.resolve(r,t):t;return Promise.all(i.map(async s=>{let m=l.dirname(s),B=o(l.basename(s)),N=r?l.resolve(r,s):s,k=l.join(u,m,B);return await I.mkdir(l.dirname(k),{recursive:!0}),I.copyFile(N,k)}))},D=async e=>{let t=[e==="yarn"?"":"install"];return new Promise((r,o)=>{let n=te(e,t,{stdio:"inherit",env:{...process.env,ADBLOCK:"1",NODE_ENV:"development",DISABLE_OPENCOLLECTIVE:"1"}});n.stdout?.on("data",i=>{console.log(i)}),n.on("close",i=>{if(i!==0){o({command:`${e} ${t.join(" ")}`});return}r()})})};import O,{dirname as ue}from"path";import{mkdirSync as ye}from"fs";import S from"path";import{writeFile as ce}from"fs/promises";import pe from"node:os";import T from"picocolors";var M=async({appName:e,root:t,template:r,packageManager:o})=>{c(`Using ${o}`),p(),c(`Initializing project with template: ${r}
`);let n=S.join(d,r),i=["**"];r==="normal"&&i.push("!tailwind.config.js","!postcss.config.js"),await A(i,t,{cwd:n,rename(m){switch(m){case"gitignore":case"eslintrc.cjs":return`.${m}`;case"README-template.md":return"README.md";default:return m}}});let s={name:e,version:"1.0.0",private:!0,type:"module",scripts:{dev:"vite",build:"tsc && vite build",lint:"eslint --fix . --ext ts,tsx --report-unused-disable-directives --max-warnings 0",preview:"vite preview",prepare:"husky"},dependencies:{axios:"^1.6.8",react:"^18.2.0","react-dom":"^18.2.0","react-router":"^6.22.3","react-router-dom":"^6.22.3"},devDependencies:{"@types/node":"^20.12.11","@types/react":"^18.2.66","@types/react-dom":"^18.2.22","@typescript-eslint/eslint-plugin":"^7.2.0","@typescript-eslint/parser":"^7.2.0","@vitejs/plugin-react":"^4.2.1",eslint:"^8.57.0","eslint-config-prettier":"^9.1.0","eslint-plugin-prettier":"^5.1.3","eslint-plugin-react-hooks":"^4.6.0","eslint-plugin-react-refresh":"^0.4.6",husky:"^9.0.11",prettier:"3.2.5",typescript:"^5.2.2",vite:"^5.2.0"}};r==="tailwind"&&(s.devDependencies={...s.devDependencies,autoprefixer:"^10.4.19",postcss:"^8.4.38","prettier-plugin-tailwindcss":"^0.5.14",tailwindcss:"^3.4.3"}),await ce(S.join(t,"package.json"),JSON.stringify(s,null,2)+pe.EOL),c(`
Installing dependencies:`);for(let m in s.dependencies)console.log(`- ${T.cyan(m)}`);c(`
Installing devDependencies:`);for(let m in s.devDependencies)console.log(`- ${T.cyan(m)}`);p(),await D(o)};import{execSync as f}from"child_process";import{rmSync as le}from"fs";import me from"path";var de=()=>{try{return f("git rev-parse --is-inside-work-tree",{stdio:"ignore"}),!0}catch{return!1}},fe=()=>{try{return f("hg --cwd . root",{stdio:"ignore"}),!0}catch{return!1}},ge=()=>{try{return f("git config init.defaultBranch",{stdio:"ignore"}),!0}catch{return!1}},C=e=>{let t=!1;try{return f("git --version",{stdio:"ignore"}),de()||fe()?!1:(f("git init",{stdio:"ignore"}),ge()||f("git checkout -b main",{stdio:"ignore"}),f("git add -A",{stdio:"ignore"}),f('git commit -m "Initial commit from chaos"',{stdio:"ignore"}),!0)}catch{if(t)try{le(me.join(e,".git"),{recursive:!0,force:!0})}catch{}return!1}};var L=async({projectPath:e,tailwind:t,packageManager:r})=>{let o=t?"tailwind":"normal",n=O.resolve(e);await j(ue(n))||(a("The application path is not writable, please check folder permissions and try again."),a("It is likely you do not have write permissions for this folder."),process.exit(1));let i=O.basename(n);ye(n,{recursive:!0});let u=process.cwd();y(`Creating a new vite app in ${n}.`),p(),process.chdir(n),await M({appName:i,root:n,template:o,packageManager:r}),C(n)&&(c("Initialized a git repository."),p()),y(`Project ${i} set up successfully`),p(),h("Inside that directory, you can run several commands:"),c(`  ${r} dev to start the development server.`),p(),c(`  ${r} build to build the App for production.`),p(),process.chdir(`${process.cwd()}/${i}`)};var F=e=>{a(`Command cancelled when setting ${e.name}`),process.exit(1)},we=(e,t,r)=>{},ve=e=>{let t=_.resolve(e.trim()),r=_.basename(t);return he(t)&&!P(t,r)&&process.exit(1),t};async function b(e,{tailwind:t}){let r={projectName:e,useTailwind:t};if(!e){let{project:i}=await R({type:"text",name:"project",message:"Your project name:",initial:"ViteReactTemplate"},{onCancel:F});r.projectName=i}if(x(r.projectName)||(console.log(1),process.exit(1)),!t){let{tailwind:i}=await R({type:"toggle",name:"tailwind",message:"Would you like to use tailwindcss?",initial:!0,active:"yes",inactive:"no"},{onCancel:F,onSubmit:we});r.useTailwind=i}y("resolve config successfully!");let o=ve(r.projectName),n=$();try{await L({projectPath:o,packageManager:n,tailwind:r.useTailwind})}catch(i){console.log(i),a("crashed when downloading packages, please try again")}}var U={name:"chaos-template-cli",version:"1.1.2",description:"",main:"src/cli.ts",scripts:{start:"tsup src/cli.ts --watch",build:"tsup-node --minify",test:"echo 'no test specified'",prepare:"husky"},bin:{chaos:"dist/index.js"},keywords:[],author:"chaosspace",type:"module",license:"ISC",dependencies:{cac:"^6.7.14","cross-spawn":"^7.0.3","fast-glob":"^3.3.2","locate-path":"^7.2.0",ora:"^8.0.1",picocolors:"^1.0.0",prompts:"^2.4.2",tsup:"^8.0.2"},devDependencies:{"@types/cross-spawn":"^6.0.6","@types/node":"^20.12.10","@types/prompts":"^2.4.9",husky:"^9.0.11",typescript:"^5.4.5"}};var w=ke();w.version(U.version);w.command("[projectName]","create project from template").option("-t, --tailwind","use tailwindcss").action(async(e,t)=>{await b(e,t)});w.help();w.parse();
